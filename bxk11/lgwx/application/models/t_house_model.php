<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/*
 * Generator By "Auto Codeigniter" At 2013/12/12 20:25:22 
 * dinghaochenAuthor: 丁昊臣
 * Email: dotnet010@gmail.com
 */
class T_house_model extends CI_Model
{
	/**
	 * @COLUMN_KEY		PRI
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_id;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(50)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_name;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		text
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		text
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_explain;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	0
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_developer_id;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(50)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_developer;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_province;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_city;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		varchar
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		varchar(200)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_address;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		YES
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $user_id;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		smallint
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		smallint(6)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_type;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		datetime
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		datetime
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_opendate;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		datetime
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		datetime
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_checkdate;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		varchar
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		varchar(255)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_url;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(100)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_link;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(100)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_activity;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(200)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_designers;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(200)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_schemes;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		smallint
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		smallint(6)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_is_hot;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		smallint
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		smallint(6)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_is_recommend;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		smallint
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		smallint(6)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_status;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_layouts;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_views;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_likes;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		int
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		int(11)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_sort;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(200)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_pic1;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		NO
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(200)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_pic2;

	/**
	 * @COLUMN_KEY		
	 * @DATA_TYPE		char
	 * @IS_NULLABLE		YES
	 * @COLUMN_DEFAULT	
	 * @COLUMN_TYPE		char(200)
	 * @EXTRA			
	 * @COLUMN_COMMENT	
	 */
	public $house_pic3;

	public function __construct()
	{
		parent::__construct();
		$this->house_explain="";
		$this->house_developer_id="";
		$this->house_developer="";
		$this->house_address="";
		$this->house_url="";
		$this->house_link="";
		$this->house_activity="";
		$this->house_designers="";
		$this->house_schemes="";
		$this->house_is_hot=0;
		$this->house_is_recommend=0;
		$this->house_status=1;
		$this->house_layouts=1;
		$this->house_views=0;
		$this->house_likes=0;
		$this->house_sort=0;
		$this->house_pic1="";
		$this->house_pic2="";
		$this->house_pic3="";
		$this->load->database();
	}

	/**
	 * 根据主键获取单条记录
	 *
	 * @PRIMARY KEY house_id
	 *
	 * @return 对象
	*/
	public function get($house_id)
	{
		return $this->db->get_where('t_house',array('house_id' => $house_id))->row();
	}
	

	/**
	 * 获取记录列表
	 * 
	 * 默认参数：获取按主键升序排列的前10条记录
	 *
	 * @param $limit		每页纪录数
	 * @param $offset		结果集的偏移
	 * @param $order_field	排序字段
	 * @param $order_type	排序类型 ASC | DESC
	 *
	 * @return				对象数组
	 * get_list(10,0) =>	select * from t_house limit 0,10
	 */
	public function get_list($limit = 10, $offset = 0, $order_field = 'house_id', $order_type = 'ASC')
	{
		$this->db->order_by($order_field, $order_type);
		return $this->db->get('t_house', $limit, $offset)->result();
	}

	/**
	 * 获取所有记录
	 *
	 * 默认参数：获取按主键升序排列的所有记录
	 *
	 * @param $order_field	排序字段
	 * @param $order_type	排序类型 ASC | DESC
	 *
	 * @return				对象数组
	 */
	public function get_all($order_field = 'house_id', $order_type = 'ASC')
	{
		$this->db->order_by($order_field, $order_type);
		return $this->db->get('t_house')->result();
	}

	/**
	 * 获取表中所有记录的行数，用于分页 
	 */
	public function count_all()
	{
		return $this->db->count_all('t_house');
	}

	/**
	 * 查询	
	 *
	 * 默认参数：根据查询字段和关键词，返回按主键升序排列的前10条记录
	 *
	 * @param $field_name	查询的字段
	 * @param $keywords		查询的关键字
	 * @param $limit		每页纪录数
	 * @param $offset		结果集的偏移
	 * @param $order_field	排序字段
	 * @param $order_type	排序类型 ASC | DESC
	 *
	 * @return				对象数组
	 */
	public function search($field_name, $keywords, $limit = 10, $offset = 0, $order_field = 'house_id', $order_type = 'ASC')
	{
		$this->db->from('t_house')->like($field_name, $keywords)->order_by($order_field, $order_type)->limit($limit, $offset);
		return $this->db->get()->result();
	}

	/**
	 * 获取满足查询条件的所有记录总数，用于查询结果的分页
	 *
	 * @param $field_name	查询的字段
	 * @param $keywords		查询的关键字
	 *
	 * @return				整形
	 */
	public function count_search($field_name, $keywords)
	{
		$this->db->from('t_house')->like($field_name, $keywords);
		return $this->db->count_all_results();
	}

	/**
	 * 插入一条记录
	 *
	 * @Exception			Exception
	 *
	 * @return				return $this->db->insert()
	 */
	public function insert()
	{
		$this->db->insert('t_house', $this);
		return $this->db->insert_id();
	}

	/**
	 * 更新一条记录
	 *
	 * @Exception			Exception
	 * 
	 * @return				return $this->db->update()
	 */
	public function update()
	{
		return $this->db->update('t_house', $this, array('house_id' => $this->house_id));
	}

	/**
	 * 确认数据库表中的不能为空的列是否存在于$post数组中
	 */
	private function validation_db_is_not_nullable_rules_by_insert($post)
	{
		if(!isset($post['house_name']) || empty($post['house_name'])) return false;
		if(!isset($post['house_explain']) || empty($post['house_explain'])) return false;
		if(!isset($post['house_developer_id']) || empty($post['house_developer_id'])) return false;
		if(!isset($post['house_developer']) || empty($post['house_developer'])) return false;
		if(!isset($post['house_province']) || empty($post['house_province'])) return false;
		if(!isset($post['house_city']) || empty($post['house_city'])) return false;
		if(!isset($post['house_address']) || empty($post['house_address'])) return false;
		if(!isset($post['house_type']) || empty($post['house_type'])) return false;
		if(!isset($post['house_opendate']) || empty($post['house_opendate'])) return false;
		if(!isset($post['house_checkdate']) || empty($post['house_checkdate'])) return false;
		if(!isset($post['house_url']) || empty($post['house_url'])) return false;
		if(!isset($post['house_link']) || empty($post['house_link'])) return false;
		if(!isset($post['house_activity']) || empty($post['house_activity'])) return false;
		if(!isset($post['house_designers']) || empty($post['house_designers'])) return false;
		if(!isset($post['house_schemes']) || empty($post['house_schemes'])) return false;
		if(!isset($post['house_is_hot']) || empty($post['house_is_hot'])) return false;
		if(!isset($post['house_is_recommend']) || empty($post['house_is_recommend'])) return false;
		if(!isset($post['house_status']) || empty($post['house_status'])) return false;
		if(!isset($post['house_layouts']) || empty($post['house_layouts'])) return false;
		if(!isset($post['house_views']) || empty($post['house_views'])) return false;
		if(!isset($post['house_likes']) || empty($post['house_likes'])) return false;
		if(!isset($post['house_sort']) || empty($post['house_sort'])) return false;
		if(!isset($post['house_pic1']) || empty($post['house_pic1'])) return false;
		if(!isset($post['house_pic2']) || empty($post['house_pic2'])) return false;

		return true;
	}

	/**
	 * 确认数据库表中的不能为空的列是否存在于$post数组中
	 */
	private function validation_db_is_not_nullable_rules_by_update($post)
	{
		if(!isset($post['house_id']) || empty($post['house_id'])) return false;
		if(!isset($post['house_name']) || empty($post['house_name'])) return false;
		if(!isset($post['house_explain']) || empty($post['house_explain'])) return false;
		if(!isset($post['house_developer_id']) || empty($post['house_developer_id'])) return false;
		if(!isset($post['house_developer']) || empty($post['house_developer'])) return false;
		if(!isset($post['house_province']) || empty($post['house_province'])) return false;
		if(!isset($post['house_city']) || empty($post['house_city'])) return false;
		if(!isset($post['house_address']) || empty($post['house_address'])) return false;
		if(!isset($post['house_type']) || empty($post['house_type'])) return false;
		if(!isset($post['house_opendate']) || empty($post['house_opendate'])) return false;
		if(!isset($post['house_checkdate']) || empty($post['house_checkdate'])) return false;
		if(!isset($post['house_url']) || empty($post['house_url'])) return false;
		if(!isset($post['house_link']) || empty($post['house_link'])) return false;
		if(!isset($post['house_activity']) || empty($post['house_activity'])) return false;
		if(!isset($post['house_designers']) || empty($post['house_designers'])) return false;
		if(!isset($post['house_schemes']) || empty($post['house_schemes'])) return false;
		if(!isset($post['house_is_hot']) || empty($post['house_is_hot'])) return false;
		if(!isset($post['house_is_recommend']) || empty($post['house_is_recommend'])) return false;
		if(!isset($post['house_status']) || empty($post['house_status'])) return false;
		if(!isset($post['house_layouts']) || empty($post['house_layouts'])) return false;
		if(!isset($post['house_views']) || empty($post['house_views'])) return false;
		if(!isset($post['house_likes']) || empty($post['house_likes'])) return false;
		if(!isset($post['house_sort']) || empty($post['house_sort'])) return false;
		if(!isset($post['house_pic1']) || empty($post['house_pic1'])) return false;
		if(!isset($post['house_pic2']) || empty($post['house_pic2'])) return false;

		return true;
	}

	/**
	 * 根据主键删除单条记录
	 *
	 * @PRIMARY KEY house_id
	*/
	public function delete($house_id)
	{
		return $this->db->delete('t_house',array('house_id' => $house_id));
	}
	
	/**
	 * 根据主键获取单条记录
	 *
	 * @PRIMARY KEY s_class_id
	 *
	 * @return 数组
	 */
	public function get_house($field='house_id',$where)
	{
		return $this->db->select($field)->get_where('t_house',$where)->result();
	}
	
	/**
	 *description:根据城市id获取楼盘列表
	 *author:yanyalong
	 *date:2013/12/14
	 */
	public function getList($house_name,$house_city,$user_id){
		return $this->db->query("select * from t_house where house_city=$house_city and house_name like '%$house_name%' and user_id in(0,$user_id) order by user_id")->result();
	}
	
	/**
	 *description:查询系统是否已经存在了同名楼盘或用户是否创建了同名项目
	 *author:yanyalong
	 *date:2013/12/16
	 */
	public function is_has($house_name,$user_id,$house_city){
		return $this->db->query("select * from t_house where house_city=$house_city and user_id in(0,$user_id) and house_name='$house_name'")->result();
	}

	/**
	 * @abstract 
	 * @author liuguangping
	 *
	 */
	public function admin_search_count($house_status='',$house_type='',$ka_start='',$ka_end='',$ea_start='',$ea_end='',$house_province='',$house_city='',$like_nickname='',$like_title=''){
		$where = " AND 1=1";
		if($house_status != ''){
			$where .=" AND s.house_status=".$house_status;
		}
	
		if($house_type !=''){
			$where .=" AND s.house_type=".$house_type;
		}
	
		if($ka_start != ''){
			$where .= " AND s.house_opendate >='".$ka_start."'";
		}
		if($ka_end !=''){
			$where .= " AND s.house_opendate <='".$ka_end."'";
		}
		
		if($ea_start != ''){
			$where .= " AND s.house_checkdate >='".$ea_start."'";
		}
		if($ea_end !=''){
			$where .= " AND s.house_checkdate <='".$ea_end."'";
		}
		if($house_province != '' && $house_province !=0){
			$where .= " AND s.house_province ='".$house_province."'";
		}
		if($house_city !='' && $house_city !=0){
			$where .= " AND s.house_city ='".$house_city."'";
		}
		if($house_type == 1 || $house_type==''){
			return $this->db->query("SELECT s.user_id,s.house_name FROM t_house as s WHERE s.house_name LIKE '%".$like_title."%'".$where)->result();
		}else{
			return $this->db->query("SELECT s.user_id,s.house_name FROM t_house as s left join (SELECT user_id,user_nickname FROM t_user) as u ON s.user_id = u.user_id WHERE u.user_nickname LIKE '%".$like_nickname."%' AND s.house_name LIKE '%".$like_title."%'".$where)->result();
		}
	
	
	}
	
	
	/**
	 * @abstract 方案和条件搜索
	 * @author liuguangping
	 */
	public function admin_search($house_status='',$house_type='',$ka_start='',$ka_end='',$ea_start='',$ea_end='',$house_province='',$house_city='',$like_nickname='',$like_title='',$offset=0,$limit=10){
		$where = "AND 1=1";
		if($house_status != ''){
			$where .=" AND s.house_status=".$house_status;
		}
		
		if($house_type !=''){
			$where .=" AND s.house_type=".$house_type;
		}
		
		if($ka_start != ''){
			$where .= " AND s.house_opendate >='".$ka_start."'";
		}
		if($ka_end !=''){
			$where .= " AND s.house_opendate <='".$ka_end."'";
		}
		
		if($ea_start != ''){
			$where .= " AND s.house_checkdate >='".$ea_start."'";
		}
		if($ea_end !=''){
			$where .= " AND s.house_checkdate <='".$ea_end."'";
		}
		if($house_province != '' && $house_province !=0){
			$where .= " AND s.house_province ='".$house_province."'";
		}
		if($house_city !='' && $house_city !=0){
			$where .= " AND s.house_city ='".$house_city."'";
		}
		
		if($house_type == 1 || $house_type==''){
			return $this->db->query("SELECT s.house_id,s.house_is_hot,s.house_name,s.user_id,s.house_type,s.house_layouts,s.house_views,s.house_city,s.house_is_recommend,s.house_province,s.house_views,s.house_type,s.house_opendate,s.house_checkdate,s.house_status FROM t_house as s WHERE s.house_name LIKE '%".$like_title."%'".$where." ORDER BY s.house_id DESC LIMIT {$offset},{$limit}")->result();
	
		}else{
			return $this->db->query("SELECT u.user_nickname,s.house_id,s.house_is_hot,s.house_name,s.user_id,s.house_type,s.house_layouts,s.house_views,s.house_city,s.house_is_recommend,s.house_province,s.house_views,s.house_type,s.house_opendate,s.house_checkdate,s.house_status FROM t_house as s left join (SELECT user_nickname,user_id FROM t_user) as u ON s.user_id = u.user_id WHERE u.user_nickname LIKE '%".$like_nickname."%' AND s.house_name LIKE '%".$like_title."%'".$where." ORDER BY s.house_id DESC LIMIT {$offset},{$limit}")->result();
		//echo $this->db->last_query();exit;
		}
	
		
	}

	/**
	 *description:根据楼盘名称获取楼盘信息
	 *author:yanyalong
	 *date:2013/12/25
	 */
	public function getHouseInfoByName($house_name){
		return $this->db->query("select * from t_house where house_name='$house_name'")->row();
	}
	
	/**
	 * 修改
	 * @param array $data
	 * @param arrray $where
	 * @return boolean
	 * @author liuguangping
	 * @version jia178 v1.0 2013/11/7
	 */
	public function updates_global($data,$where){
		return $this->db->update('t_house',$data,$where)?true:false;
	}
}
